{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/sheets.ts"],"sourcesContent":["'use server';\n\nimport { google } from 'googleapis';\nimport type { sheets_v4 } from 'googleapis';\nimport type { SheetRow } from './types'; // Import SheetRow from the new types.ts\n\n// Environment variables\nconst SHEET_ID = process.env.GOOGLE_SHEET_ID;\nconst SERVICE_ACCOUNT_EMAIL = process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL;\nconst RAW_PRIVATE_KEY_FROM_ENV = process.env.GOOGLE_PRIVATE_KEY;\nconst SHEET_RANGE = process.env.GOOGLE_SHEET_RANGE || 'Sheet1!A:E'; // Default range if not specified\n\nfunction processPrivateKey(rawKeyInput: string | undefined): string | null {\n  if (typeof rawKeyInput !== 'string' || rawKeyInput.trim() === '') {\n    console.error('[SheetLib:PK_Process] CRITICAL: GOOGLE_PRIVATE_KEY environment variable is undefined, empty, or only whitespace. This is a required credential.');\n    return null;\n  }\n\n  let key = rawKeyInput.trim();\n\n  if (key.startsWith('{') && key.endsWith('}')) {\n    try {\n      const parsedJson = JSON.parse(key);\n      if (typeof parsedJson.private_key === 'string' && parsedJson.private_key.trim() !== '') {\n        console.warn('[SheetLib:PK_Process] Detected and extracted \"private_key\" field from what appears to be a full JSON object pasted into GOOGLE_PRIVATE_KEY. Using extracted key.');\n        key = parsedJson.private_key.trim();\n      } else if (parsedJson.private_key && typeof parsedJson.private_key !== 'string') {\n        console.error('[SheetLib:PK_Process] ERROR: Input looks like JSON, but \"private_key\" field is not a string. This will likely lead to auth failure. Proceeding with original input for further checks.');\n      } else if (!parsedJson.private_key) {\n         console.error('[SheetLib:PK_Process] ERROR: Input looks like JSON, but \"private_key\" field is missing. This will likely lead to auth failure. Proceeding with original input for further checks.');\n      }\n    } catch (e) {\n      // Not valid JSON. This is fine if the key itself happens to start/end with {}.\n      // console.log('[SheetLib:PK_Process] Input started/ended with {} but was not valid JSON or \"private_key\" was problematic. Processing as raw key string.');\n    }\n  }\n  \n  if ((key.startsWith('\"') && key.endsWith('\"')) || (key.startsWith(\"'\") && key.endsWith(\"'\"))) {\n    key = key.substring(1, key.length - 1);\n  }\n\n  key = key.replace(/\\\\\\\\r\\\\\\\\n/g, '\\r\\n').replace(/\\\\\\\\n/g, '\\n');\n  key = key.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n\n\n  if (!key.startsWith('-----BEGIN PRIVATE KEY-----')) {\n    console.error('[SheetLib:PK_Process] ERROR: Processed GOOGLE_PRIVATE_KEY does NOT START with \"-----BEGIN PRIVATE KEY-----\". Key is malformed or incomplete. Ensure the entire key, including this header, is correctly copied.');\n    return null;\n  }\n  if (!key.endsWith('-----END PRIVATE KEY-----')) {\n    console.error('[SheetLib:PK_Process] ERROR: Processed GOOGLE_PRIVATE_KEY does NOT END with \"-----END PRIVATE KEY-----\". Key is malformed or incomplete. Ensure the entire key, including this footer, is correctly copied.');\n    return null;\n  }\n  if (!key.includes('\\n')) {\n    console.error('[SheetLib:PK_Process] ERROR: Processed GOOGLE_PRIVATE_KEY does NOT contain any newline characters. PEM private keys are multi-line. Ensure newlines were preserved or correctly represented (e.g., as actual newlines or literal \\\\n in the .env string that get unescaped).');\n    return null;\n  }\n  \n  const coreKeyContent = key\n    .substring('-----BEGIN PRIVATE KEY-----'.length, key.length - '-----END PRIVATE KEY-----'.length)\n    .trim();\n\n  if (coreKeyContent.length === 0) {\n    console.error('[SheetLib:PK_Process] ERROR: Processed GOOGLE_PRIVATE_KEY has PEM markers but NO content in between. This key is invalid.');\n    return null;\n  }\n  \n  // console.log('[SheetLib:PK_Process] SUCCESS: GOOGLE_PRIVATE_KEY appears structurally valid after processing.');\n  return key;\n}\n\nexport async function getSheetsClient(): Promise<sheets_v4.Sheets | null> {\n  const errorParts: string[] = [];\n  if (!SHEET_ID) errorParts.push('CRITICAL: GOOGLE_SHEET_ID environment variable is not set.');\n  if (!SERVICE_ACCOUNT_EMAIL) errorParts.push('CRITICAL: GOOGLE_SERVICE_ACCOUNT_EMAIL environment variable is not set.');\n\n  const processedPrivateKey = processPrivateKey(RAW_PRIVATE_KEY_FROM_ENV);\n\n  if (!processedPrivateKey) {\n    // processPrivateKey already logged specific details.\n    errorParts.push('CRITICAL: GOOGLE_PRIVATE_KEY is missing, empty, or critically malformed after processing. Check server logs above for \"[SheetLib:PK_Process]\" for specific details on the private key issue. Authentication will fail.');\n  }\n\n  if (errorParts.length > 0) {\n    const fullMessage = '[SheetLib:getSheetsClient] CRITICAL: Cannot initialize Google Sheets client due to missing or invalid core credentials:\\n- ' + errorParts.join('\\n- ');\n    console.error(fullMessage);\n    return null;\n  }\n\n  try {\n    // console.log('[SheetLib:getSheetsClient] Attempting to create GoogleAuth client with processed credentials...');\n    const auth = new google.auth.GoogleAuth({\n      credentials: {\n        client_email: SERVICE_ACCOUNT_EMAIL!, \n        private_key: processedPrivateKey!, \n      },\n      scopes: ['https://www.googleapis.com/auth/spreadsheets'],\n    });\n    // console.log('[SheetLib:getSheetsClient] GoogleAuth client instance created successfully.');\n    return google.sheets({ version: 'v4', auth });\n  } catch (error: any) {\n    console.error('[SheetLib:getSheetsClient] CRITICAL: Error during GoogleAuth instantiation (the step before calling google.sheets API):');\n    console.error('Error Name:', error.name);\n    console.error('Error Message:', error.message);\n    if (error.stack) console.error('Error Stack (partial):', error.stack.substring(0, 500));\n\n    if (error.message?.includes('DECODER routines') || error.message?.includes('PEM routines') || error.message?.includes('private key') || error.message?.includes('asn1 encoding')) {\n      console.error(\n        '[SheetLib:getSheetsClient] Auth Init Error Detail: This error (' + error.message + ') STRONGLY indicates an issue with the PROCESSED_PRIVATE_KEY format or value. ' +\n        'The key might have passed initial structural checks by `processPrivateKey` but is still not parsable by the underlying crypto library. ' +\n        'Verify the original key source and ensure it is correctly copied into the GOOGLE_PRIVATE_KEY environment variable. Double-check for hidden characters or incorrect newline representations if copying from complex sources.'\n      );\n    }\n    return null;\n  }\n}\n\n\nexport async function getSheetData(): Promise<SheetRow[] | null> {\n  let sheets: sheets_v4.Sheets | null = null;\n  try {\n      sheets = await getSheetsClient();\n  } catch (clientError: any) {\n      // This catch is for truly unexpected errors *within* getSheetsClient itself,\n      // though getSheetsClient is designed to return null for known config/auth issues.\n      console.error('[SheetLib:getSheetData] CRITICAL: Unexpected fatal error from getSheetsClient() call itself:', clientError.message);\n      if (clientError.stack) console.error(clientError.stack);\n      return null; // Signifies critical config/init error\n  }\n\n  if (!sheets) {\n     // getSheetsClient returning null means a configuration issue was detected and logged by it.\n     console.error('[SheetLib:getSheetData] Google Sheets client is null (client initialization failed due to credential/config issues detailed above). Cannot fetch data. Returning null to indicate configuration error.');\n     return null; // Signifies critical config/init error\n  }\n\n  if (!SHEET_ID){ // Should have been caught by getSheetsClient, but as a safeguard for direct calls.\n    console.error('[SheetLib:getSheetData] ConfigurationError: GOOGLE_SHEET_ID is not configured on the server. Cannot fetch data. Returning null.');\n    return null;\n  }\n  if (!SHEET_RANGE){\n    // Default is used if not set, so this might be less critical unless default is also bad.\n    console.warn('[SheetLib:getSheetData] Warning: GOOGLE_SHEET_RANGE is not configured on the server. Using default: ' + SHEET_RANGE); \n  }\n\n  try {\n    // console.log(`[SheetLib:getSheetData] Fetching data from SHEET_ID: ${SHEET_ID}, RANGE: ${SHEET_RANGE}`);\n    const response = await sheets.spreadsheets.values.get({\n      spreadsheetId: SHEET_ID,\n      range: SHEET_RANGE,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length === 0) {\n      // console.log('[SheetLib:getSheetData] No data found in the specified sheet range or sheet is empty. Returning empty array.');\n      return []; // Success, but no data\n    }\n\n    const headers = rows[0].map(header => String(header).trim());\n    const dataRows = rows.slice(1);\n\n    const expectedHeaders = ['Donor/Opp', 'Action/Next Step', 'Lead', 'Priority', 'Probability'];\n    const missingHeaders = expectedHeaders.filter(eh => !headers.includes(eh));\n    if (missingHeaders.length > 0) {\n       console.warn(`[SheetLib:getSheetData] Sheet is missing expected headers: [${missingHeaders.join(', ')}]. Current headers: [${headers.join(', ')}]. Data mapping might be incorrect or incomplete.`);\n    }\n\n    const mappedData = dataRows.map((rowArray: any[]) => {\n      const rowData: Partial<SheetRow> = {};\n      headers.forEach((header, index) => {\n        const cellValue = rowArray[index] !== undefined && rowArray[index] !== null ? String(rowArray[index]) : '';\n        const key = header as keyof SheetRow; \n\n        if (expectedHeaders.includes(header)) { \n            if ((key === 'Priority' || key === 'Probability')) {\n               const value = cellValue.trim();\n               if (['High', 'Medium', 'Low'].includes(value)) {\n                  rowData[key] = value as 'High' | 'Medium' | 'Low';\n               } else {\n                  rowData[key] = 'Medium'; \n               }\n            } else {\n               rowData[key] = cellValue;\n            }\n        }\n      });\n      expectedHeaders.forEach(eh => {\n        const key = eh as keyof SheetRow;\n        if (!(key in rowData)) {\n          if (key === 'Priority' || key === 'Probability') {\n            rowData[key] = 'Medium'; \n          } else {\n            rowData[key] = ''; \n          }\n        }\n      });\n      return rowData as SheetRow;\n    }).filter(row => { \n      const opp = row['Donor/Opp']?.trim();\n      const action = row['Action/Next Step']?.trim();\n      const lead = row.Lead?.trim();\n      return !!(opp || action || lead);\n    });\n    return mappedData;\n\n  } catch (error: any) {\n    console.error('[SheetLib:getSheetData] CRITICAL ERROR during sheets.spreadsheets.values.get API call:');\n    \n    let details = 'Unknown API error during data fetch.';\n    if (error.message) {\n      details = error.message;\n    }\n    \n    // Check for common Google API error structures\n    if (error.response?.data?.error?.message) {\n        details = `Google API Error: ${error.response.data.error.message} (Status: ${error.response.data.error.code})`;\n    } else if (error.errors && Array.isArray(error.errors) && error.errors.length > 0) {\n        details = `Google API Error: ${error.errors[0].message} (Reason: ${error.errors[0].reason})`;\n    } else if (error.code) { // e.g., Node.js system errors like ENOTFOUND\n        details = `System Error Code: ${error.code}, Message: ${error.message}`;\n    }\n\n    let specificHint = details; // Start with the most specific detail we found\n\n    const gErrorCode = error.response?.data?.error?.code || (typeof error.code === 'number' ? error.code : null);\n\n\n    if (details.includes('PERMISSION_DENIED') || gErrorCode === 403) {\n        specificHint = `Permission Denied. Ensure the service account (${SERVICE_ACCOUNT_EMAIL || 'SERVICE_ACCOUNT_EMAIL_not_set_in_env'}) has at least 'Viewer' access to the Google Sheet (ID: ${SHEET_ID || 'SHEET_ID_not_set_in_env'}). You need to share the sheet with the service account email.`;\n    } else if (details.includes('Requested entity was not found') || gErrorCode === 404) {\n        specificHint = `Sheet Not Found. Verify that the GOOGLE_SHEET_ID ('${SHEET_ID || 'SHEET_ID_not_set_in_env'}') is correct and the sheet exists. Also check if the GOOGLE_SHEET_RANGE ('${SHEET_RANGE || 'Using default range'}') is valid for this sheet (e.g., the sheet name in the range exists).`;\n    } else if (details.includes('INVALID_ARGUMENT') || details.includes('Unable to parse range') || gErrorCode === 400) {\n        specificHint = `Invalid Argument or Range. The GOOGLE_SHEET_RANGE ('${SHEET_RANGE || 'Using default range'}') is likely invalid or does not exist in the sheet. Ensure it's in 'SheetName!A1:E' format. The error might also indicate a malformed Sheet ID.`;\n    } else if (details.includes('UNAUTHENTICATED') || gErrorCode === 401) {\n        specificHint = `Authentication Failed. The service account credentials may be invalid or expired. This is less likely if client initialization succeeded but could indicate a permissions revocation or token issue. Check the validity of your service account key.`;\n    } else if (details.includes('ENOTFOUND') || details.includes('EAI_AGAIN')) {\n        specificHint = `Network Error: Could not resolve hostname (e.g., www.googleapis.com). Check server's internet connectivity and DNS resolution. Error: ${error.message}`;\n    } else if (gErrorCode === 500 || gErrorCode === 503) {\n        specificHint = `Google API Server Error (Status: ${gErrorCode}). This is likely a temporary issue on Google's side. Try again later. Error: ${details}`;\n    }\n\n\n    console.error(`[SheetLib:getSheetData] Full Error Object Structure (if available from Google API):`, JSON.stringify(error.response?.data || error.errors || error, null, 2));\n    console.error(`[SheetLib:getSheetData] Processed Error Details from API call: ${details}`);\n    console.error(`[SheetLib:getSheetData] Specific User Hint for API call failure: ${specificHint}. Returning empty array to prevent UI crash, but data fetch failed.`);\n    return []; // API call failed, return empty array. Config was likely okay if client initialized.\n  }\n}\n\nexport async function appendSheetRow(rowData: Omit<SheetRow, ''>): Promise<boolean> {\n  let sheets: sheets_v4.Sheets | null = null;\n  try {\n      sheets = await getSheetsClient();\n  } catch (clientError: any) {\n      console.error('[SheetLib:appendSheetRow] Error obtaining Google Sheets client in appendSheetRow:', clientError.message);\n      return false; \n  }\n\n   if (!sheets) {\n      console.error(\"[SheetLib:appendSheetRow] Google Sheets client not available for appendSheetRow (client initialization failed due to credential/config issues detailed above). Cannot append data.\");\n      return false; \n   }\n   if (!SHEET_ID) { \n    console.error(\"[SheetLib:appendSheetRow] ConfigurationError: GOOGLE_SHEET_ID is not configured for appendSheetRow.\");\n    return false;\n   }\n   if (!SHEET_RANGE) { \n    console.error(\"[SheetLib:appendSheetRow] ConfigurationError: GOOGLE_SHEET_RANGE is not configured for appendSheetRow (though it has a default).\");\n    // Allow continuation if default is used, but log.\n   }\n\n\n  const values = [\n    rowData['Donor/Opp'],\n    rowData['Action/Next Step'],\n    rowData.Lead,\n    rowData.Priority,\n    rowData.Probability\n  ];\n\n  try {\n    await sheets.spreadsheets.values.append({\n      spreadsheetId: SHEET_ID,\n      range: SHEET_RANGE, \n      valueInputOption: 'USER_ENTERED',\n      insertDataOption: 'INSERT_ROWS',\n      requestBody: {\n        values: [values],\n      },\n    });\n    // console.log('[SheetLib:appendSheetRow] Row appended successfully to Google Sheet.');\n    return true;\n  } catch (error: any) {\n    console.error('[SheetLib:appendSheetRow] Error appending sheet row via Google Sheets API:');\n     let details = 'Unknown API error during data append.';\n    if (error.message) {\n      details = error.message;\n    }\n     if (error.response?.data?.error?.message) {\n        details = `Google API Error: ${error.response.data.error.message} (Status: ${error.response.data.error.code})`;\n    } else if (error.errors && Array.isArray(error.errors) && error.errors.length > 0) {\n        details = `Google API Error: ${error.errors[0].message} (Reason: ${error.errors[0].reason})`;\n    }\n    console.error(`[SheetLib:appendSheetRow] Full Error Object:`, JSON.stringify(error.response?.data || error.errors || error, null, 2));\n    console.error(`[SheetLib:appendSheetRow] Processed Error Details: ${details}`);\n    return false;\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 482, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/auth.ts"],"sourcesContent":["import { cookies } from 'next/headers';\nimport type { ReadonlyRequestCookies } from 'next/dist/server/web/spec-extension/adapters/request-cookies';\n\nconst AUTH_COOKIE_NAME = 'sheetsync_auth';\nconst ADMIN_USERNAME = process.env.ADMIN_USERNAME;\nconst ADMIN_PASSWORD = process.env.ADMIN_PASSWORD;\n\nif (!ADMIN_USERNAME || !ADMIN_PASSWORD) {\n  console.warn('Admin credentials are not set in environment variables. Admin login will not work.');\n}\n\nexport function checkCredentials(username?: string | null, password?: string | null): boolean {\n  if (!ADMIN_USERNAME || !ADMIN_PASSWORD) {\n    return false; // Cannot authenticate if credentials aren't set\n  }\n  return username === ADMIN_USERNAME && password === ADMIN_PASSWORD;\n}\n\nexport async function setAuthCookie(): Promise<void> {\n  const cookieStore = cookies();\n  cookieStore.set(AUTH_COOKIE_NAME, 'true', {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    path: '/admin', // Restrict cookie to admin paths\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24, // 24 hours validity\n  });\n}\n\nexport async function clearAuthCookie(): Promise<void> {\n  const cookieStore = cookies();\n  cookieStore.delete(AUTH_COOKIE_NAME);\n}\n\nexport function isAuthenticated(cookieStore?: ReadonlyRequestCookies): boolean {\n  const store = cookieStore || cookies();\n  const authCookie = store.get(AUTH_COOKIE_NAME);\n  return authCookie?.value === 'true';\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,MAAM,mBAAmB;AACzB,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc;AACjD,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc;AAEjD,IAAI,CAAC,kBAAkB,CAAC,gBAAgB;IACtC,QAAQ,IAAI,CAAC;AACf;AAEO,SAAS,iBAAiB,QAAwB,EAAE,QAAwB;IACjF,IAAI,CAAC,kBAAkB,CAAC,gBAAgB;QACtC,OAAO,OAAO,gDAAgD;IAChE;IACA,OAAO,aAAa,kBAAkB,aAAa;AACrD;AAEO,eAAe;IACpB,MAAM,cAAc,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAC1B,YAAY,GAAG,CAAC,kBAAkB,QAAQ;QACxC,UAAU;QACV,QAAQ,oDAAyB;QACjC,MAAM;QACN,UAAU;QACV,QAAQ,KAAK,KAAK;IACpB;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAC1B,YAAY,MAAM,CAAC;AACrB;AAEO,SAAS,gBAAgB,WAAoC;IAClE,MAAM,QAAQ,eAAe,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IACnC,MAAM,aAAa,MAAM,GAAG,CAAC;IAC7B,OAAO,YAAY,UAAU;AAC/B","debugId":null}},
    {"offset": {"line": 527, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/validators.ts"],"sourcesContent":["import { z } from 'zod';\n\nexport const loginSchema = z.object({\n  username: z.string().min(1, 'Username is required'),\n  password: z.string().min(1, 'Password is required'),\n});\n\nexport type LoginFormData = z.infer<typeof loginSchema>;\n\nexport const sheetRowSchema = z.object({\n  'Donor/Opp': z.string().min(1, 'Donor/Opportunity is required'),\n  'Action/Next Step': z.string().min(1, 'Action/Next Step is required'),\n  Lead: z.string().min(1, 'Lead is required'),\n  Priority: z.enum(['High', 'Medium', 'Low'], {\n    errorMap: () => ({ message: 'Please select a valid priority' }),\n  }),\n  Probability: z.enum(['High', 'Medium', 'Low'], {\n    errorMap: () => ({ message: 'Please select a valid probability' }),\n  }),\n});\n\nexport type SheetRowFormData = z.infer<typeof sheetRowSchema>;\n\n// Schema for Google Sheet Configuration Form\nexport const sheetConfigSchema = z.object({\n    sheetId: z.string().min(10, 'Sheet ID seems too short. Please check the copied ID.').trim(),\n    sheetRange: z.string()\n                .min(3, 'Sheet range is required (e.g., SheetName!A:E)')\n                .regex(/^[a-zA-Z0-9\\s]+!([A-Z]+):([A-Z]+)$/, 'Invalid range format. Expected format like \"SheetName!A:E\" with uppercase column letters.'),\n    serviceAccountEmail: z.string().email('Invalid service account email format. Please enter a valid email address.'),\n    privateKey: z.string()\n        .transform(keyInput => {\n            let key = keyInput.trim(); \n\n            // If the entire pasted content is enclosed in quotes (single or double), remove them\n            if ((key.startsWith('\"') && key.endsWith('\"')) || (key.startsWith(\"'\") && key.endsWith(\"'\"))) {\n                key = key.substring(1, key.length - 1);\n            }\n            \n            // Unescape literal \"\\\\r\\\\n\" (windows newline escape) first, then \"\\\\n\" (unix newline escape) to actual newlines.\n            key = key.replace(/\\\\\\\\r\\\\\\\\n/g, '\\r\\n').replace(/\\\\\\\\n/g, '\\n');\n            // Normalize any remaining Windows-style newlines (\\r\\n) or Mac-style newlines (\\r) to Unix-style newlines (\\n).\n            key = key.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n            \n            return key.trim(); // Final trim of the processed key\n        })\n        .pipe(\n            z.string()\n            .min(100, 'Private key is too short. Ensure you have copied the full key from the JSON file.')\n            .startsWith('-----BEGIN PRIVATE KEY-----', 'Private key must start with \"-----BEGIN PRIVATE KEY-----\". Check for missing parts or extra characters at the beginning.')\n            .endsWith('-----END PRIVATE KEY-----', 'Private key must end with \"-----END PRIVATE KEY-----\". Check for missing parts or extra characters at the end.')\n            .refine(key => key.includes('\\n'), { message: \"Private key must be a multi-line string. Ensure newlines are preserved when copying, or that '\\\\n'/'\\\\r\\\\n' sequences from JSON were correctly interpreted.\" })\n            .refine(key => {\n                if (key.includes('\"private_key\":') || key.includes(\"'private_key':\")) {\n                    return false;\n                }\n                const coreKey = key.replace('-----BEGIN PRIVATE KEY-----', '').replace('-----END PRIVATE KEY-----', '').trim();\n                return coreKey.length > 0;\n            }, {message: \"It looks like you might have pasted more than just the private key string (e.g., includes 'private_key:' part from JSON), or the key content between PEM markers is empty.\"})\n        ),\n});\n\nexport type SheetConfigFormData = z.infer<typeof sheetConfigSchema>;"],"names":[],"mappings":";;;;;AAAA;;AAEO,MAAM,cAAc,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAClC,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;AAC9B;AAIO,MAAM,iBAAiB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACrC,aAAa,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC/B,oBAAoB,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACtC,MAAM,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,UAAU,oIAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAU;KAAM,EAAE;QAC1C,UAAU,IAAM,CAAC;gBAAE,SAAS;YAAiC,CAAC;IAChE;IACA,aAAa,oIAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAU;KAAM,EAAE;QAC7C,UAAU,IAAM,CAAC;gBAAE,SAAS;YAAoC,CAAC;IACnE;AACF;AAKO,MAAM,oBAAoB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACtC,SAAS,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,yDAAyD,IAAI;IACzF,YAAY,oIAAA,CAAA,IAAC,CAAC,MAAM,GACP,GAAG,CAAC,GAAG,iDACP,KAAK,CAAC,sCAAsC;IACzD,qBAAqB,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IACtC,YAAY,oIAAA,CAAA,IAAC,CAAC,MAAM,GACf,SAAS,CAAC,CAAA;QACP,IAAI,MAAM,SAAS,IAAI;QAEvB,qFAAqF;QACrF,IAAI,AAAC,IAAI,UAAU,CAAC,QAAQ,IAAI,QAAQ,CAAC,QAAU,IAAI,UAAU,CAAC,QAAQ,IAAI,QAAQ,CAAC,MAAO;YAC1F,MAAM,IAAI,SAAS,CAAC,GAAG,IAAI,MAAM,GAAG;QACxC;QAEA,iHAAiH;QACjH,MAAM,IAAI,OAAO,CAAC,eAAe,QAAQ,OAAO,CAAC,UAAU;QAC3D,gHAAgH;QAChH,MAAM,IAAI,OAAO,CAAC,SAAS,MAAM,OAAO,CAAC,OAAO;QAEhD,OAAO,IAAI,IAAI,IAAI,kCAAkC;IACzD,GACC,IAAI,CACD,oIAAA,CAAA,IAAC,CAAC,MAAM,GACP,GAAG,CAAC,KAAK,qFACT,UAAU,CAAC,+BAA+B,4HAC1C,QAAQ,CAAC,6BAA6B,kHACtC,MAAM,CAAC,CAAA,MAAO,IAAI,QAAQ,CAAC,OAAO;QAAE,SAAS;IAA8J,GAC3M,MAAM,CAAC,CAAA;QACJ,IAAI,IAAI,QAAQ,CAAC,qBAAqB,IAAI,QAAQ,CAAC,mBAAmB;YAClE,OAAO;QACX;QACA,MAAM,UAAU,IAAI,OAAO,CAAC,+BAA+B,IAAI,OAAO,CAAC,6BAA6B,IAAI,IAAI;QAC5G,OAAO,QAAQ,MAAM,GAAG;IAC5B,GAAG;QAAC,SAAS;IAA4K;AAErM","debugId":null}},
    {"offset": {"line": 594, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions.ts"],"sourcesContent":["'use server';\n\nimport { z } from 'zod';\nimport { revalidatePath } from 'next/cache';\nimport { checkCredentials, setAuthCookie, clearAuthCookie } from './auth';\nimport { loginSchema, sheetRowSchema, sheetConfigSchema } from './validators'; // Added sheetConfigSchema\nimport { appendSheetRow, getSheetsClient } from './sheets'; // Added getSheetsClient\nimport type { SheetRowFormData, SheetConfigFormData } from './validators'; // Added SheetConfigFormData\n\nexport type FormState = {\n  message: string;\n  success: boolean;\n  errors?: Record<string, string[] | undefined>;\n  details?: string; // Optional details field for test connection\n};\n\nexport async function loginAction(\n  prevState: FormState | null,\n  formData: FormData\n): Promise<FormState> {\n  try {\n    const parsed = loginSchema.safeParse({\n      username: formData.get('username'),\n      password: formData.get('password'),\n    });\n\n    if (!parsed.success) {\n      return {\n        message: 'Invalid form data.',\n        success: false,\n        errors: parsed.error.flatten().fieldErrors,\n      };\n    }\n\n    const { username, password } = parsed.data;\n\n    if (checkCredentials(username, password)) {\n      await setAuthCookie();\n      revalidatePath('/admin'); \n      return { message: 'Login successful!', success: true };\n    } else {\n      return { message: 'Invalid username or password.', success: false };\n    }\n  } catch (error) {\n    console.error('Login error:', error);\n    return { message: 'An unexpected error occurred during login.', success: false };\n  }\n}\n\nexport async function logoutAction(): Promise<void> {\n   await clearAuthCookie();\n   revalidatePath('/admin');\n}\n\n\nexport async function submitDataAction(\n  prevState: FormState | null,\n  formData: FormData\n): Promise<FormState> {\n\n  try {\n    const parsed = sheetRowSchema.safeParse({\n      'Donor/Opp': formData.get('Donor/Opp'),\n      'Action/Next Step': formData.get('Action/Next Step'),\n      Lead: formData.get('Lead'),\n      Priority: formData.get('Priority'),\n      Probability: formData.get('Probability'),\n    });\n\n    if (!parsed.success) {\n       console.log(\"Validation errors:\", parsed.error.flatten().fieldErrors);\n      return {\n        message: 'Invalid form data. Please check the fields.',\n        success: false,\n        errors: parsed.error.flatten().fieldErrors,\n      };\n    }\n\n    const dataToAppend: SheetRowFormData = parsed.data;\n\n    if (!process.env.GOOGLE_SHEET_ID || !process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL || !process.env.GOOGLE_PRIVATE_KEY) {\n        return { message: 'Google Sheet connection is not configured on the server.', success: false };\n    }\n\n    const success = await appendSheetRow(dataToAppend);\n\n    if (success) {\n      // Removed revalidatePath('/admin'); It will be handled client-side to prevent potential logout issues.\n      revalidatePath('/'); // Revalidate public dashboard\n      return {\n        message: 'Data submitted successfully!',\n        success: true\n      };\n    } else {\n      return { message: 'Failed to submit data to Google Sheet. Please check the server console logs for more specific error details from the Google Sheets API.', success: false };\n    }\n  } catch (error) {\n    console.error('Submit data error:', error);\n    return { message: 'An unexpected error occurred while submitting data.', success: false };\n  }\n}\n\n\nexport async function saveSheetConfigAction(\n  prevState: FormState | null,\n  formData: FormData\n): Promise<FormState> {\n  try {\n    const parsed = sheetConfigSchema.safeParse({\n      sheetId: formData.get('sheetId'),\n      sheetRange: formData.get('sheetRange'),\n      serviceAccountEmail: formData.get('serviceAccountEmail'),\n      privateKey: formData.get('privateKey'),\n    });\n\n    if (!parsed.success) {\n       console.log(\"Config Validation errors:\", parsed.error.flatten().fieldErrors);\n      return {\n        message: 'Invalid configuration data. Please check the fields.',\n        success: false,\n        errors: parsed.error.flatten().fieldErrors,\n      };\n    }\n\n    const configData: SheetConfigFormData = parsed.data;\n    \n    console.log('Received valid sheet configuration data for .env.local preview generation:', {\n        sheetId: configData.sheetId,\n        sheetRange: configData.sheetRange,\n        serviceAccountEmail: configData.serviceAccountEmail,\n        privateKey: '[REDACTED - validated but not stored by this action]',\n    });\n\n    revalidatePath('/admin');\n\n    return {\n        message: 'Configuration format validated successfully. The preview for .env.local has been generated. Copy the content into your .env.local file and restart/redeploy the server for these settings to be used by the application backend.',\n        success: true\n    };\n\n  } catch (error) {\n    console.error('Save sheet config error:', error);\n    return { message: 'An unexpected error occurred while validating the configuration for preview.', success: false };\n  }\n}\n\nexport async function testSheetConnectionAction(\n  prevState: FormState | null\n): Promise<FormState> {\n  const missingEnvVars = [];\n  if (!process.env.GOOGLE_SHEET_ID) missingEnvVars.push('GOOGLE_SHEET_ID');\n  if (!process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL) missingEnvVars.push('GOOGLE_SERVICE_ACCOUNT_EMAIL');\n  if (!process.env.GOOGLE_PRIVATE_KEY || process.env.GOOGLE_PRIVATE_KEY.trim() === '' || process.env.GOOGLE_PRIVATE_KEY.trim() === '\"\"' || process.env.GOOGLE_PRIVATE_KEY.trim() === \"''\") missingEnvVars.push('GOOGLE_PRIVATE_KEY');\n  if (!process.env.GOOGLE_SHEET_RANGE) missingEnvVars.push('GOOGLE_SHEET_RANGE');\n\n  if (missingEnvVars.length > 0) {\n    return {\n      success: false,\n      message: 'Connection test failed: Server is missing required environment variables.',\n      details: `Missing: ${missingEnvVars.join(', ')}. Please ensure these are set in your .env.local file or hosting environment and the server is restarted. The private key must be the actual key, not an empty string.`,\n    };\n  }\n\n  const sheets = await getSheetsClient();\n  if (!sheets) {\n    return {\n      success: false,\n      message: 'Connection test failed: Could not initialize Google Sheets client.',\n      details: 'This usually indicates an issue with the service account credentials (email or private key format/value) or their parsing. Check server logs for more specific errors related to Google Auth initialization. Ensure GOOGLE_PRIVATE_KEY is correctly formatted and not empty or malformed (e.g. missing PEM markers, incorrect newline escaping).',\n    };\n  }\n\n  try {\n    const response = await sheets.spreadsheets.get({\n      spreadsheetId: process.env.GOOGLE_SHEET_ID,\n      fields: 'properties.title',\n    });\n\n    if (response.status === 200 && response.data.properties?.title) {\n       revalidatePath('/admin'); \n      return {\n        success: true,\n        message: 'Connection test successful!',\n        details: `Successfully connected to sheet titled: \"${response.data.properties.title}\". The application should be able to read from and write to this sheet if permissions are correctly set.`,\n      };\n    } else {\n      return {\n        success: false,\n        message: 'Connection test partially successful: Client initialized, but could not retrieve sheet properties.',\n        details: `Received status ${response.status}. This might indicate issues with the Sheet ID or permissions for the service account.`,\n      };\n    }\n  } catch (error: any) {\n    console.error('Google Sheets connection test error:', error);\n    let details = 'An unexpected error occurred during the connection test.';\n    if (error.message) {\n      details = error.message;\n    }\n    if (error.response?.data?.error?.message) {\n        details = error.response.data.error.message;\n    }\n\n    if (details.includes('PERMISSION_DENIED')) {\n        details = `Permission Denied. Ensure the service account (${process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL}) has at least 'Viewer' (for reading) and 'Editor' (for writing) access to the Google Sheet (ID: ${process.env.GOOGLE_SHEET_ID}).`;\n    } else if (details.includes('Requested entity was not found')) {\n        details = `Sheet Not Found. Verify that the GOOGLE_SHEET_ID ('${process.env.GOOGLE_SHEET_ID}') is correct and the sheet exists.`;\n    } else if (details.includes('invalid_grant') || details.includes('Could not load the default credentials')) {\n        details = `Authentication Failed. This can be due to an invalid service account email, an incorrectly formatted or expired private key, or issues with the Google Cloud project setup. Ensure GOOGLE_PRIVATE_KEY is valid.`;\n    } else if (String(error.message || '').includes('error:0A000152:SSL routines::unsafe legacy renegotiation disabled') || String(error.message || '').includes('UNABLE_TO_GET_ISSUER_CERT_LOCALLY')) {\n        details = `SSL/TLS connection issue. This might be a network configuration problem, proxy issue, or an outdated CA certificate store on the server. Original error: ${error.message}`;\n    } else if (String(error.message || '').includes('error:1E08010C:DECODER routines::unsupported') || String(error.message || '').includes('PEM routines') || String(error.message || '').includes('private key') || String(error.message || '').includes('asn1 encoding')) {\n        details = `Private key format error. The GOOGLE_PRIVATE_KEY provided is likely malformed or not a valid PEM key. It should start with '-----BEGIN PRIVATE KEY-----' and end with '-----END PRIVATE KEY-----', with the key content in between. Original error: ${error.message}`;\n    }\n    \n    return {\n      success: false,\n      message: 'Connection test failed during API call.',\n      details: details,\n    };\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 821, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 907, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/admin-page-client.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/admin-page-client.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/admin-page-client.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAuS,GACpU,qEACA","debugId":null}},
    {"offset": {"line": 921, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/admin-page-client.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/admin-page-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/admin-page-client.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAmR,GAChT,iDACA","debugId":null}},
    {"offset": {"line": 935, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 945, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/dashboard-table.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport const DashboardTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call DashboardTable() from the server but DashboardTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/dashboard-table.tsx <module evaluation>\",\n    \"DashboardTable\",\n);\n"],"names":[],"mappings":";;;AAAA;;AACO,MAAM,iBAAiB,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EAChD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,oEACA","debugId":null}},
    {"offset": {"line": 959, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/dashboard-table.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport const DashboardTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call DashboardTable() from the server but DashboardTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/dashboard-table.tsx\",\n    \"DashboardTable\",\n);\n"],"names":[],"mappings":";;;AAAA;;AACO,MAAM,iBAAiB,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EAChD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,gDACA","debugId":null}},
    {"offset": {"line": 973, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 983, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/admin-dashboard-display-wrapper.tsx"],"sourcesContent":["\nimport type { SheetRow } from '@/lib/types';\nimport { getSheetData } from '@/lib/sheets';\nimport { DashboardTable } from '@/components/dashboard-table';\nimport { AlertTriangle, ServerCrash, InfoIcon } from 'lucide-react';\n\n// This is now a Server Component\nexport default async function AdminDashboardDisplayWrapper() {\n  let tableData: SheetRow[] = []; // Default to empty array\n  let errorOccurred = false; // General API or unexpected error\n  let isConfigError = false; // Specific flag for configuration errors\n  let userFriendlyMessage = \"Live Dashboard Preview from Google Sheet.\";\n\n\n  try {\n    const dataResult = await getSheetData();\n\n    if (dataResult === null) {\n      isConfigError = true;\n      userFriendlyMessage = \"CRITICAL CONFIGURATION ERROR: Could not connect to Google Sheets. Please ensure GOOGLE_SHEET_ID, GOOGLE_SERVICE_ACCOUNT_EMAIL, and a valid GOOGLE_PRIVATE_KEY are correctly set in your environment variables and the server has been restarted. Check server logs for '[SheetLib:]' messages for details.\";\n      tableData = [];\n    } else {\n      tableData = Array.isArray(dataResult) ? dataResult : [];\n      if (tableData.length === 0) {\n        userFriendlyMessage = \"No data available in the Google Sheet for preview, or the sheet is empty. If this is unexpected, verify the sheet contents and API configuration (Sheet ID, Range, Permissions). Check server logs if an API error was logged by [SheetLib:getSheetData].\";\n      }\n    }\n  } catch (error: any) {\n    console.error(\"[AdminDashboardDisplayWrapper SC] Unexpected error fetching data for admin dashboard:\", error);\n    errorOccurred = true;\n    userFriendlyMessage = `An unexpected error occurred while fetching data: ${error.message || 'Unknown error'}. Please check server logs.`;\n    tableData = [];\n  }\n\n  if (isConfigError) {\n    return (\n        <div className=\"my-4 p-4 border border-destructive/50 rounded-md bg-destructive/10\">\n            <div className=\"flex items-center gap-3 text-destructive\">\n                <AlertTriangle className=\"h-8 w-8\" />\n                <div>\n                    <p className=\"font-semibold\">Configuration Error Loading Preview</p>\n                    <p className=\"text-sm\">\n                        {userFriendlyMessage}\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n  }\n\n  if (errorOccurred) {\n    return (\n        <div className=\"my-4 p-4 border border-destructive/20 rounded-md bg-destructive/10\">\n            <div className=\"flex items-center gap-3 text-destructive\">\n                <ServerCrash className=\"h-8 w-8\" />\n                <div>\n                    <p className=\"font-semibold\">Error Fetching Dashboard Preview Data</p>\n                    <p className=\"text-sm\">\n                        {userFriendlyMessage}\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n  }\n\n  if (tableData.length === 0 && !isConfigError && !errorOccurred) {\n    return (\n         <div className=\"my-4 p-4 border border-dashed border-border rounded-md bg-muted/50\">\n            <div className=\"flex items-center gap-3 text-muted-foreground\">\n                <InfoIcon className=\"h-8 w-8 text-primary\" />\n                <div>\n                    <p className=\"font-semibold text-card-foreground\">No Data for Preview</p>\n                    <p className=\"text-sm\">\n                       {userFriendlyMessage}\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n  }\n\n  return <DashboardTable initialData={tableData} />;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAAA;AAAA;;;;;AAGe,eAAe;IAC5B,IAAI,YAAwB,EAAE,EAAE,yBAAyB;IACzD,IAAI,gBAAgB,OAAO,kCAAkC;IAC7D,IAAI,gBAAgB,OAAO,yCAAyC;IACpE,IAAI,sBAAsB;IAG1B,IAAI;QACF,MAAM,aAAa,MAAM,CAAA,GAAA,oHAAA,CAAA,eAAY,AAAD;QAEpC,IAAI,eAAe,MAAM;YACvB,gBAAgB;YAChB,sBAAsB;YACtB,YAAY,EAAE;QAChB,OAAO;YACL,YAAY,MAAM,OAAO,CAAC,cAAc,aAAa,EAAE;YACvD,IAAI,UAAU,MAAM,KAAK,GAAG;gBAC1B,sBAAsB;YACxB;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yFAAyF;QACvG,gBAAgB;QAChB,sBAAsB,CAAC,kDAAkD,EAAE,MAAM,OAAO,IAAI,gBAAgB,2BAA2B,CAAC;QACxI,YAAY,EAAE;IAChB;IAEA,IAAI,eAAe;QACjB,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;kCACX,8OAAC,wNAAA,CAAA,gBAAa;wBAAC,WAAU;;;;;;kCACzB,8OAAC;;0CACG,8OAAC;gCAAE,WAAU;0CAAgB;;;;;;0CAC7B,8OAAC;gCAAE,WAAU;0CACR;;;;;;;;;;;;;;;;;;;;;;;IAMvB;IAEA,IAAI,eAAe;QACjB,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;kCACX,8OAAC,oNAAA,CAAA,cAAW;wBAAC,WAAU;;;;;;kCACvB,8OAAC;;0CACG,8OAAC;gCAAE,WAAU;0CAAgB;;;;;;0CAC7B,8OAAC;gCAAE,WAAU;0CACR;;;;;;;;;;;;;;;;;;;;;;;IAMvB;IAEA,IAAI,UAAU,MAAM,KAAK,KAAK,CAAC,iBAAiB,CAAC,eAAe;QAC9D,qBACK,8OAAC;YAAI,WAAU;sBACZ,cAAA,8OAAC;gBAAI,WAAU;;kCACX,8OAAC,sMAAA,CAAA,WAAQ;wBAAC,WAAU;;;;;;kCACpB,8OAAC;;0CACG,8OAAC;gCAAE,WAAU;0CAAqC;;;;;;0CAClD,8OAAC;gCAAE,WAAU;0CACT;;;;;;;;;;;;;;;;;;;;;;;IAMtB;IAEA,qBAAO,8OAAC,wIAAA,CAAA,iBAAc;QAAC,aAAa;;;;;;AACtC","debugId":null}},
    {"offset": {"line": 1180, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/page.tsx"],"sourcesContent":["\nimport { cookies } from 'next/headers';\nimport { isAuthenticated } from '@/lib/auth';\nimport AdminPageClient from './admin-page-client';\nimport AdminDashboardDisplayWrapper from '@/components/admin-dashboard-display-wrapper';\n\nexport default async function AdminPage() {\n  const cookieStore = cookies();\n  const loggedIn = isAuthenticated(cookieStore);\n\n  return <AdminPageClient \n            initialLoggedIn={loggedIn} \n            dashboardDisplaySlot={<AdminDashboardDisplayWrapper />} \n         />;\n}\n\n// Ensure dynamic rendering because authentication depends on cookies\n// and page content can change based on auth state.\nexport const dynamic = 'force-dynamic';\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;;;;AAEe,eAAe;IAC5B,MAAM,cAAc,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAC1B,MAAM,WAAW,CAAA,GAAA,kHAAA,CAAA,kBAAe,AAAD,EAAE;IAEjC,qBAAO,8OAAC,+IAAA,CAAA,UAAe;QACb,iBAAiB;QACjB,oCAAsB,8OAAC,8JAAA,CAAA,UAA4B;;;;;;;;;;AAE/D;AAIO,MAAM,UAAU","debugId":null}}]
}