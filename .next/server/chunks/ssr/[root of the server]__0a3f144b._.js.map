{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/sheets.ts"],"sourcesContent":["'use server';\n\nimport { google } from 'googleapis';\nimport type { sheets_v4 } from 'googleapis';\n\n// Define the structure of a row in your sheet\nexport interface SheetRow {\n  'Donor/Opp': string;\n  'Action/Next Step': string;\n  Lead: string;\n  Priority: 'High' | 'Medium' | 'Low';\n  Probability: 'High' | 'Medium' | 'Low';\n}\n\n// Environment variables\nconst SHEET_ID = process.env.GOOGLE_SHEET_ID;\nconst SERVICE_ACCOUNT_EMAIL = process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL;\nconst SHEET_RANGE = process.env.GOOGLE_SHEET_RANGE || 'Sheet1!A:E'; // Default range if not specified\n\nlet PRIVATE_KEY: string | undefined;\nconst rawPrivateKeyFromEnv = process.env.GOOGLE_PRIVATE_KEY;\n\nif (typeof rawPrivateKeyFromEnv === 'string' && rawPrivateKeyFromEnv.trim() !== '') {\n    let key = rawPrivateKeyFromEnv.trim();\n    \n    // Strip surrounding quotes if present (common for multi-line env vars copied from JSON strings)\n    if ((key.startsWith('\"') && key.endsWith('\"')) ||\n        (key.startsWith(\"'\") && key.endsWith(\"'\"))) {\n        key = key.substring(1, key.length - 1);\n    }\n\n    // Unescape literal '\\\\n' to actual newline characters.\n    const unescapedKeyRaw = key.replace(/\\\\n/g, '\\n');\n    // Trim whitespace around the entire unescaped block before checking markers.\n    const unescapedKey = unescapedKeyRaw.trim(); \n\n    if (\n        unescapedKey.startsWith('-----BEGIN PRIVATE KEY-----') &&\n        unescapedKey.endsWith('-----END PRIVATE KEY-----') &&\n        unescapedKey.includes('\\n') // Ensure there are actual newlines within the key block\n    ) {\n        const coreKeyContent = unescapedKey\n            .substring('-----BEGIN PRIVATE KEY-----'.length, unescapedKey.length - '-----END PRIVATE KEY-----'.length)\n            .trim();\n        if (coreKeyContent.length > 0) {\n            PRIVATE_KEY = unescapedKey; // Use the trimmed, unescaped key\n            // console.log('Successfully processed GOOGLE_PRIVATE_KEY.');\n        } else {\n            console.warn(\n                'GOOGLE_PRIVATE_KEY warning: Processed key has PEM markers but no content in between. ' +\n                'Original GOOGLE_PRIVATE_KEY (first 30 chars, trimmed): \"' + (rawPrivateKeyFromEnv || \"\").trim().substring(0, 30) + '\". ' +\n                'Sheet operations will likely fail.'\n            );\n            PRIVATE_KEY = undefined;\n        }\n    } else {\n        console.warn(\n            'GOOGLE_PRIVATE_KEY warning: Malformed structure after processing. ' +\n            `Key starts with (after processing and trimming): \"${unescapedKey.substring(0, 30)}...\". ` +\n            `Key ends with (after processing and trimming): \"...${unescapedKey.substring(Math.max(0, unescapedKey.length - 30))}\". ` +\n            `Includes newlines: ${unescapedKey.includes('\\n')}. ` +\n            'Original GOOGLE_PRIVATE_KEY (first 30 chars, trimmed): \"' + (rawPrivateKeyFromEnv || \"\").trim().substring(0, 30) + '\". ' +\n            'Ensure it is a valid PEM key with actual newlines between markers, correctly escaped newlines (\\\\n) if stored as a single line string in .env, and no extraneous characters.'\n        );\n        PRIVATE_KEY = undefined;\n    }\n} else {\n    if (rawPrivateKeyFromEnv === undefined) {\n        // console.log('GOOGLE_PRIVATE_KEY is not set. Sheet operations requiring auth will fail.');\n    } else {\n        console.warn('GOOGLE_PRIVATE_KEY is set but is empty or only whitespace. Sheet operations requiring auth will fail.');\n    }\n    PRIVATE_KEY = undefined;\n}\n\n// Initial check for logging purposes; actual guard is in getSheetsClient\n(() => {\n  const missingVarsWarn = [];\n  if (!SHEET_ID) missingVarsWarn.push('GOOGLE_SHEET_ID');\n  if (!SERVICE_ACCOUNT_EMAIL) missingVarsWarn.push('GOOGLE_SERVICE_ACCOUNT_EMAIL');\n  \n  if (!PRIVATE_KEY && rawPrivateKeyFromEnv && rawPrivateKeyFromEnv.trim() !== '') { \n    missingVarsWarn.push('GOOGLE_PRIVATE_KEY (set but failed processing - see detailed warning above)');\n  } else if (!PRIVATE_KEY && (!rawPrivateKeyFromEnv || rawPrivateKeyFromEnv.trim() === '')) {\n     missingVarsWarn.push('GOOGLE_PRIVATE_KEY (not set or empty)');\n  }\n\n  if (missingVarsWarn.length > 0) {\n    console.warn(\n      `SheetSync Initialization Warning: One or more Google Sheets API credentials are problematic. Sheet operations are likely to fail. Problematic variables: [${missingVarsWarn.join(', ')}]`\n    );\n  }\n})();\n\n\nexport async function getSheetsClient(): Promise<sheets_v4.Sheets | null> {\n  if (!SHEET_ID || !SERVICE_ACCOUNT_EMAIL || !PRIVATE_KEY) {\n    const errorParts = ['Cannot initialize Sheets client due to missing/invalid credentials:'];\n    if (!SHEET_ID) errorParts.push('- GOOGLE_SHEET_ID is not set.');\n    if (!SERVICE_ACCOUNT_EMAIL) errorParts.push('- GOOGLE_SERVICE_ACCOUNT_EMAIL is not set.');\n    \n    if (!PRIVATE_KEY) {\n      if (!rawPrivateKeyFromEnv) errorParts.push('- GOOGLE_PRIVATE_KEY is not set.');\n      else if (rawPrivateKeyFromEnv.trim() === '' || rawPrivateKeyFromEnv.trim() === '\"\"' || rawPrivateKeyFromEnv.trim() === \"''\") errorParts.push('- GOOGLE_PRIVATE_KEY is set but is empty or only whitespace.');\n      else errorParts.push('- GOOGLE_PRIVATE_KEY is set but was malformed or failed structural/PEM checks (see previous warnings for details).');\n    }\n    console.error(errorParts.join('\\n  '));\n    return null;\n  }\n\n  try {\n    const auth = new google.auth.GoogleAuth({\n      credentials: {\n        client_email: SERVICE_ACCOUNT_EMAIL,\n        private_key: PRIVATE_KEY, \n      },\n      scopes: ['https://www.googleapis.com/auth/spreadsheets'],\n    });\n    // console.log('GoogleAuth client initialized successfully.');\n    return google.sheets({ version: 'v4', auth });\n  } catch (error: any) {\n    console.error('CRITICAL Error initializing Google Auth client with processed PRIVATE_KEY:', error.message);\n    const pkPreview = PRIVATE_KEY ? `${PRIVATE_KEY.substring(0, Math.min(40, PRIVATE_KEY.length))}...${PRIVATE_KEY.substring(Math.max(0, PRIVATE_KEY.length - Math.min(40, PRIVATE_KEY.length)))}` : \"PRIVATE_KEY_IS_UNDEFINED\";\n    console.error(`Private key used (preview): ${pkPreview}`);\n    if (error instanceof Error && (error.message.includes('DECODER routines') || error.message.includes('PEM routines') || error.message.includes('private key') || error.message.includes('asn1 encoding'))) {\n        console.error(\n          'This error during auth initialization often indicates an issue with the GOOGLE_PRIVATE_KEY format or value even after initial checks. Ensure it is a valid PEM-formatted private key, with actual newlines if copied from a source that used \\\\n. The key might have passed basic structural checks but is still not parsable by the crypto library.'\n        );\n    }\n    return null;\n  }\n}\n\nexport async function getSheetData(): Promise<SheetRow[]> {\n  const sheets = await getSheetsClient();\n  if (!sheets) {\n     console.warn('getSheetData: Google Sheets client is not available (possibly due to configuration issues). Returning empty data.');\n     return [];\n  }\n  if (!SHEET_ID){ \n    console.warn('getSheetData: GOOGLE_SHEET_ID is not configured. Returning empty data.');\n    return [];\n  }\n\n  try {\n    const response = await sheets.spreadsheets.values.get({\n      spreadsheetId: SHEET_ID,\n      range: SHEET_RANGE,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length === 0) {\n      // console.log('No data found in the specified sheet range or sheet is empty.');\n      return [];\n    }\n\n    const headers = rows[0].map(header => String(header).trim());\n    const dataRows = rows.slice(1);\n\n    const expectedHeaders = ['Donor/Opp', 'Action/Next Step', 'Lead', 'Priority', 'Probability'];\n    const missingHeaders = expectedHeaders.filter(eh => !headers.includes(eh));\n    if (missingHeaders.length > 0) {\n       console.warn(`Sheet is missing expected headers: [${missingHeaders.join(', ')}]. Current headers: [${headers.join(', ')}]. Data mapping might be incorrect or incomplete.`);\n    }\n\n    return dataRows.map((row) => {\n      const rowData: Partial<SheetRow> = {};\n      headers.forEach((header, index) => {\n        const cellValue = row[index] !== undefined && row[index] !== null ? String(row[index]) : ''; \n\n        if (expectedHeaders.includes(header)) { \n            if ((header === 'Priority' || header === 'Probability')) {\n               const value = cellValue.trim();\n               if (['High', 'Medium', 'Low'].includes(value)) {\n                  rowData[header as keyof SheetRow] = value as 'High' | 'Medium' | 'Low';\n               } else {\n                  if (value !== '') {\n                    // console.warn(`Invalid value \"${value}\" for ${header} in row. Defaulting to Medium.`);\n                  }\n                  rowData[header as keyof SheetRow] = 'Medium'; // Default if invalid or empty\n               }\n            } else {\n               rowData[header as keyof SheetRow] = cellValue;\n            }\n        }\n      });\n      // Ensure all expected keys exist, even if not in sheet headers or row is shorter\n      expectedHeaders.forEach(eh => {\n        const key = eh as keyof SheetRow;\n        if (!(key in rowData)) {\n          if (key === 'Priority' || key === 'Probability') {\n            rowData[key] = 'Medium'; \n          } else {\n            rowData[key] = ''; \n          }\n        }\n      });\n      return rowData as SheetRow;\n    }).filter(row => Object.values(row).some(val => typeof val === 'string' && val.trim() !== '')); // Filter out completely empty effective rows\n\n\n  } catch (error: any) {\n    console.error('CRITICAL ERROR in getSheetData:', error); \n    console.error('Error message:', error.message);\n    if (error.stack) console.error('Stack trace:', error.stack);\n    if (error.response?.data) console.error('Google API response error data:', error.response.data);\n    \n    if (error instanceof Error) {\n        if (error.message.includes('PERMISSION_DENIED')) {\n            console.error(`getSheetData Error: Permission denied. Ensure the service account (${SERVICE_ACCOUNT_EMAIL}) has at least read access to the Google Sheet (${SHEET_ID}).`);\n        } else if (error.message.includes('Requested entity was not found')) {\n            console.error(`getSheetData Error: Sheet or range not found. Verify GOOGLE_SHEET_ID (${SHEET_ID}) and GOOGLE_SHEET_RANGE (${SHEET_RANGE}).`);\n        } else if (error.message.includes('UNAUTHENTICATED') || error.message.includes('invalid_grant')) {\n            console.error('getSheetData Error: Authentication failed. This could be due to an invalid service account email, private key, or incorrect project setup.');\n        } else if (error.message.includes('DECODER routines') || error.message.includes('PEM routines')) {\n            console.error('getSheetData Error: A cryptographic error occurred, often related to a malformed private key. Ensure GOOGLE_PRIVATE_KEY is correctly formatted in your environment.');\n        }\n    }\n    return []; \n  }\n}\n\nexport async function appendSheetRow(rowData: Omit<SheetRow, ''>): Promise<boolean> {\n  const sheets = await getSheetsClient();\n   if (!sheets) {\n      console.error(\"Cannot append row: Google Sheets client not available (possibly due to configuration issues).\");\n      return false;\n   }\n   if (!SHEET_ID) { \n     console.error(\"Cannot append row: GOOGLE_SHEET_ID is not configured.\");\n     return false;\n   }\n\n  const values = [\n    rowData['Donor/Opp'],\n    rowData['Action/Next Step'],\n    rowData.Lead,\n    rowData.Priority,\n    rowData.Probability\n  ];\n\n  try {\n    await sheets.spreadsheets.values.append({\n      spreadsheetId: SHEET_ID,\n      range: SHEET_RANGE, \n      valueInputOption: 'USER_ENTERED', \n      insertDataOption: 'INSERT_ROWS', \n      requestBody: {\n        values: [values],\n      },\n    });\n    // console.log('Row appended successfully to Google Sheet.');\n    return true;\n  } catch (error: any) {\n    console.error('Error appending sheet row to Google Sheets API:', error.message);\n     if (error instanceof Error) {\n        if (error.message.includes('PERMISSION_DENIED')) {\n            console.error(`appendSheetRow Error: Permission denied. Ensure the service account (${SERVICE_ACCOUNT_EMAIL}) has write access to the Google Sheet (${SHEET_ID}).`);\n        } else if (error.message.includes('UNAUTHENTICATED') || error.message.includes('invalid_grant')) {\n            console.error('appendSheetRow Error: Authentication failed while appending. Check service account credentials and permissions.');\n        }\n     }\n    return false;\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 434, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 503, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/auth.ts"],"sourcesContent":["import { cookies } from 'next/headers';\nimport type { ReadonlyRequestCookies } from 'next/dist/server/web/spec-extension/adapters/request-cookies';\n\nconst AUTH_COOKIE_NAME = 'sheetsync_auth';\nconst ADMIN_USERNAME = process.env.ADMIN_USERNAME;\nconst ADMIN_PASSWORD = process.env.ADMIN_PASSWORD;\n\nif (!ADMIN_USERNAME || !ADMIN_PASSWORD) {\n  console.warn('Admin credentials are not set in environment variables. Admin login will not work.');\n}\n\nexport function checkCredentials(username?: string | null, password?: string | null): boolean {\n  if (!ADMIN_USERNAME || !ADMIN_PASSWORD) {\n    return false; // Cannot authenticate if credentials aren't set\n  }\n  return username === ADMIN_USERNAME && password === ADMIN_PASSWORD;\n}\n\nexport async function setAuthCookie(): Promise<void> {\n  const cookieStore = cookies();\n  cookieStore.set(AUTH_COOKIE_NAME, 'true', {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    path: '/admin', // Restrict cookie to admin paths\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24, // 24 hours validity\n  });\n}\n\nexport async function clearAuthCookie(): Promise<void> {\n  const cookieStore = cookies();\n  cookieStore.delete(AUTH_COOKIE_NAME);\n}\n\nexport function isAuthenticated(cookieStore?: ReadonlyRequestCookies): boolean {\n  const store = cookieStore || cookies();\n  const authCookie = store.get(AUTH_COOKIE_NAME);\n  return authCookie?.value === 'true';\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,MAAM,mBAAmB;AACzB,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc;AACjD,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc;AAEjD,IAAI,CAAC,kBAAkB,CAAC,gBAAgB;IACtC,QAAQ,IAAI,CAAC;AACf;AAEO,SAAS,iBAAiB,QAAwB,EAAE,QAAwB;IACjF,IAAI,CAAC,kBAAkB,CAAC,gBAAgB;QACtC,OAAO,OAAO,gDAAgD;IAChE;IACA,OAAO,aAAa,kBAAkB,aAAa;AACrD;AAEO,eAAe;IACpB,MAAM,cAAc,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAC1B,YAAY,GAAG,CAAC,kBAAkB,QAAQ;QACxC,UAAU;QACV,QAAQ,oDAAyB;QACjC,MAAM;QACN,UAAU;QACV,QAAQ,KAAK,KAAK;IACpB;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAC1B,YAAY,MAAM,CAAC;AACrB;AAEO,SAAS,gBAAgB,WAAoC;IAClE,MAAM,QAAQ,eAAe,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IACnC,MAAM,aAAa,MAAM,GAAG,CAAC;IAC7B,OAAO,YAAY,UAAU;AAC/B","debugId":null}},
    {"offset": {"line": 548, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/admin-page-client.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/admin-page-client.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/admin-page-client.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAuS,GACpU,qEACA","debugId":null}},
    {"offset": {"line": 562, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/admin-page-client.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/admin-page-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/admin-page-client.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAmR,GAChT,iDACA","debugId":null}},
    {"offset": {"line": 576, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 586, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/admin/page.tsx"],"sourcesContent":["\nimport { cookies } from 'next/headers';\nimport { isAuthenticated } from '@/lib/auth';\nimport AdminPageClient from './admin-page-client';\n\nexport default async function AdminPage() {\n  const cookieStore = cookies();\n  const loggedIn = isAuthenticated(cookieStore);\n\n  return <AdminPageClient initialLoggedIn={loggedIn} />;\n}\n\n// Ensure dynamic rendering because authentication depends on cookies\n// and page content can change based on auth state.\nexport const dynamic = 'force-dynamic';\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;AAEe,eAAe;IAC5B,MAAM,cAAc,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAC1B,MAAM,WAAW,CAAA,GAAA,kHAAA,CAAA,kBAAe,AAAD,EAAE;IAEjC,qBAAO,8OAAC,+IAAA,CAAA,UAAe;QAAC,iBAAiB;;;;;;AAC3C;AAIO,MAAM,UAAU","debugId":null}}]
}